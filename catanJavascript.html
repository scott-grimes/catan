<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    border: 1px solid #d3d3d3;
    background-color: HoneyDew;
}
</style>
</head>
<body onload="startGame()">
<script>
var tileColor = {"ocean":"HoneyDew", "pasture": "white", "field" : "Khaki","mountains": "grey","hills": "LightSalmon","desert":"yellow","forest":"OliveDrab","port":"HoneyDew"};

var board = Board();

//array of objects representing the areas a road could be built or a settlement could be built. These are the clickable boundries
var edgeBoundaries = [];
var verticesBoundaries = [];

function startGame() {
    myGameArea.start();
    drawBaseBoard();
}
var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = 500;
        this.canvas.height = 400;
        this.hexSize = 36;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        
        //on update do something
    },clear : function(){
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
}


function drawBaseBoard(){
b = board;
    for(var i = 0;i<b.length;i+=1){
    	for(var j = 0;j<b[i].length;j+=1){
    	if(b[i][j] != null){
   			 DrawHex(b[i][j]);		
             }
             }
    
}
}

function Hex(id,x,y,type,tileVal){

    this.id = id;
    this.x = x;
    this.y = y;
    this.type = type;
    this.tileVal = tileVal;
    
}

function DrawHex(hex) {
    //center of gameboard at x_0, y_0
	x_0 = 250;
	y_0 = 200;
    size = myGameArea.hexSize;
    //x_a,y_a are the axial coordinates of the hex
    x_a = hex.x
    y_a = hex.y
    
    /*
    function hex_to_pixel(hex):
    x = size * sqrt(3) * (hex.q + hex.r/2)
    y = size * 3/2 * hex.r
    return Point(x, y)
    */
    
    //x,y are pixel coords of the center of the hexagon
    x = x_0+size*(x_a+y_a/2)*Math.sqrt(3);
    y = y_0+y_a*size*1.5;
    
    ctx = myGameArea.context;
    if(hex.type!="ocean" && hex.type!="port"){
    ctx.beginPath();
    size = size*.8;
	ctx.moveTo (x,y-size);  
	ctx.lineTo (x+size*Math.sqrt(3)/2,y-size*.5);  
	ctx.lineTo (x+size*Math.sqrt(3)/2,y+size*.5);      
	ctx.lineTo (x,y+size);   
	ctx.lineTo (x-size*Math.sqrt(3)/2,y+size*.5);  
	ctx.lineTo (x-size*Math.sqrt(3)/2,y-size*.5);   
	ctx.closePath();
    ctx.stroke();
    ctx.fillStyle=tileColor[hex.type];
    ctx.fill();
    }
    if(hex.type!="ocean"){
    ctx.font="20px Georgia";
    ctx.fillStyle="black";
    
    if(hex.type=="port"){
    ctx.fillText("P",x-6,y+5);
    
    }else{
    
    ctx.fillText(String(hex.tileVal),x-5,y+5);
    }
    }
    
}

function Board(){
  resources = ["field","field","field","field","forest","forest","forest","forest","pasture","pasture","pasture","pasture","mountains","mountains","mountains","hills","hills","hills","desert"]
 ports = ["ore","wheat","wood","wool","brick","generic","generic","generic","generic"]
  tileCount = [2,3,3,4,4,5,5,6,6,8,8,9,9,10,10,11,11,12]
  
  shuffle(resources);
  shuffle(ports);
  shuffle(tileCount);
  
tiles = [[null,null,null,null,null,null,null],[null,null,null,null,null,null,null],[null,null,null,null,null,null,null],[null,null,null,null,null,null,null],[null,null,null,null,null,null,null],[null,null,null,null,null,null,null],[null,null,null,null,null,null,null]];


//places land tiles randomly into our game board. capital letters represent land tiles
    i = 0;
    countIndex = 0;
    ident = 65;
    for(var row = -2;row<=2;row+=1){
      count = -Math.abs(row)+5;
      start = -row-2;
      if(row>0){
        start = -2;
      }
      for(var col = start;col<start+count;col+=1){
        
        tileVal = 0;
        if(resources[i]=='desert'){
          tileVal=7;
          }
        else{
          tileVal = tileCount[countIndex];
          countIndex+=1;
          }
        id = String.fromCharCode(ident);
        h = new Hex(id,col,row,resources[i],tileVal);
        [x,y] = axialToMatrix(col,row);
        tiles[y][x] = h;
        i+=1;
        ident+=1;
     }
    }
    
    
    
    
    oceans = [[1,-3],[3,-3],[3,-1],[2,1],[0,3],[-2,3],[-3,2],[-3,0],[-1,-2]];
    
    ports = [[0,-3],[2,-3],[3,-2],[3,0],[1,2],[-1,3],[-3,3],[-3,1],[-2,-1]];
    
    ident = 97; // lowercase a
    //add our empty oceans  (lowercase letters)
    for(var i = 0;i<9;i+=1){
    xa = oceans[i][0];
    ya = oceans[i][1];
      h = new Hex(String.fromCharCode(ident),xa,ya,'ocean',0);
        [x,y] = axialToMatrix(xa,ya);
       tiles[y][x] = h;
      
      ident+=1;
    }
    
    ident = 1; // number as a string
    //add our empty oceans  (lowercase letters)
    for(var i = 0;i<9;i+=1){
    xa = ports[i][0];
    ya = ports[i][1];
      h = new Hex(ident.toString(),xa,ya,'port',0);
      h.port = ports[i];
      [x,y] = axialToMatrix(xa,ya);
      tiles[y][x] = h;
      ident+=1;
    }
    
return tiles;
}


function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

//given axial coordinates, returns the matrix row/column containing our hexagon
function axialToMatrix(ax,ay){
 y = ay+3;
 x = ax+3+Math.min(0,Math.abs(ay));
return [x,y];
}

//given pixel coordinates x,y, returns the axial coordinates of the hexagon. returns null if you did not click on a valid hexagon
function pixelToHex(x,y){
	size = myGameArea.hexSize;
	xa = (x * Math.sqrt(3)/3 - y / 3) / size;
    ya = y * 2/3 / size;
    distance = (abs(xa) + abs(xa + ya)+ abs(ya)) / 2
    if(distance<=2){
    
return [xa,ya];
}
return null;
}




</script>

<p>Catan!</p>

</body>
</html>
